document.addEventListener("DOMContentLoaded", function() {

  // --- Function to update summary ---
  function updateSummary() {
    var e = document.getElementById("iataFrom"),
        t = document.getElementById("city"),
        n = document.getElementById("outboundDate"),
        a = document.getElementById("returnDate"),
        u = document.getElementById("cc_sb3_sb3_flighthotel_sb3_flight_airlines_0"),
        r = document.getElementById("cc_sb3_sb3_flighthotel_sb3_flight_classofservice"),
        l = document.getElementById("cc_sb3_sb3_flighthotel_sb3_flight_airlines_0"),
        o = document.getElementById("cc_sb3_sb3_flighthotel_flighthotel_numGuests1"),
        d = document.getElementById("cc_sb3_sb3_flighthotel_flighthotel_numGuests2"),
        i = document.getElementById("cc_sb3_sb3_flighthotel_flighthotel_numGuests3");

    var s = e ? e.value : "",
        c = t ? t.value : "",
        m = n ? n.value : "",
        v = a ? a.value : "",
        f = u ? u.value : "",
        h = r ? r.value : "",
        g = l ? l.value : "",
        p = o ? o.value : "",
        y = d ? d.value : "",
        b = i ? i.value : "";

    var E = p + " in Room 1";
    if (g >= 2) E += ", " + y + " in Room 2";
    if (g == 3) E += ", " + b + " in Room 3";

    var L = s + " → " + c + " | " + m + " → " + v + " | " + (f || "Any Airline") +
            " | Class: " + h + " | Rooms: " + g + ", Guests: " + E;

    var w = document.getElementById("summary");
    if (w) w.value = L;
  }

  // --- Function to attach updateAges on guest dropdowns ---
  var guestIds = {
    "cc_sb3_sb3_flighthotel_flighthotel_numGuests1": 1,
    "cc_sb3_sb3_flighthotel_flighthotel_numGuests2": 2,
    "cc_sb3_sb3_flighthotel_flighthotel_numGuests3": 3
  };

  Object.keys(guestIds).forEach(function(id) {
    var el = document.getElementById(id);
    if (el) {
      el.setAttribute("onchange", "updateAges(" + guestIds[id] + ")");
      // Also update summary when guest number changes
      el.setAttribute("onchange", el.getAttribute("onchange") + ";updateSummary()");
    }
  });

  // --- Attach updateSummary to other elements ---
  var summaryIds = [
    "cc_sb3_sb3_flighthotel_sb3_flight_airlines_0",
    "cc_sb3_sb3_flighthotel_sb3_flight_classofservice"
  ];

  summaryIds.forEach(function(id) {
    var el = document.getElementById(id);
    if (el) {
      el.setAttribute("onchange", "updateSummary()");
    }
  });

  // --- Initialize listeners for text inputs and select elements ---
  function initSummaryListeners() {
    var elements = document.querySelectorAll("input, select");
    elements.forEach(function(el) {
      el.addEventListener("input", updateSummary);
      el.addEventListener("change", updateSummary);
    });

    // Handle autosuggest clicks dynamically
    document.addEventListener("click", function(event) {
      if (event.target.classList.contains("suggestion-item")) {
        setTimeout(updateSummary, 50);
      }
    });

    // Initial summary
    updateSummary();
  }

  initSummaryListeners();

});
