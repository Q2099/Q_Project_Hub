document.addEventListener("DOMContentLoaded", function() {
  const iataFrom = document.getElementById("cc_sb3_sb3_flighthotel_sb3_flighthotel_iataFrom"),
    city = document.getElementById("cc_sb3_sb3_flighthotel_sb3_flighthotel_city"),
    outboundDate = document.getElementById("cc_sb3_sb3_flighthotel_sb3_flighthotel_outboundDate"),
    returnDate = document.getElementById("cc_sb3_sb3_flighthotel_sb3_hotel_numNights"),
    airline = document.getElementById("cc_sb3_sb3_flighthotel_sb3_flight_airlines_0"),
    classOfService = document.getElementById("cc_sb3_sb3_flighthotel_sb3_flight_classofservice"),
    numRooms = document.getElementById("cc_sb3_sb3_flighthotel_sb3_flighthotel_numRooms"),
    numGuests1 = document.getElementById("cc_sb3_sb3_flighthotel_flighthotel_numGuests1"),
    numGuests2 = document.getElementById("cc_sb3_sb3_flighthotel_flighthotel_numGuests2"),
    numGuests3 = document.getElementById("cc_sb3_sb3_flighthotel_flighthotel_numGuests3"),
    summaryBox = document.getElementById("summary");

  // ⭐ Get all star rating checkboxes
  const starRatings = document.querySelectorAll(".star_rating_copy input[type='checkbox']");

  // ✅ Class code → label map
  const classNames = {
    E: "Economy",
    P: "Premium Economy",
    B: "Business",
    F: "First"
  };

  function updateSummary() {
    const fromVal = iataFrom?.value || "—";
    const cityVal = city?.value || "—";
    const outVal = outboundDate?.value || "—";
    const retVal = returnDate?.value || "—";
    const airlineVal = airline?.value || "Any Airline";
    const classVal = classOfService?.value;
    const className = classNames[classVal] || classVal || "Economy";
    const rooms = numRooms?.value || "1";
    const guests1 = numGuests1?.value || "0";
    const guests2 = numGuests2?.value || "0";
    const guests3 = numGuests3?.value || "0";

    // ⭐ Collect selected star ratings
    const selectedStars = Array.from(starRatings)
      .filter(cb => cb.checked)
      .map(cb => cb.value)
      .join(", ") || "Any";

    let guestSummary = `Room 1: ${guests1}`;
    if (rooms >= 2) guestSummary += `, Room 2: ${guests2}`;
    if (rooms >= 3) guestSummary += `, Room 3: ${guests3}`;

    summaryBox.value = `${fromVal} → ${cityVal} | ${outVal} → ${retVal} | ${airlineVal} | Class: ${className} | Stars: ${selectedStars}★ | Rooms: ${rooms} | Guests: ${guestSummary}`;
  }

  // Add listeners for all inputs
  [
    iataFrom, city, outboundDate, returnDate,
    airline, classOfService, numRooms, numGuests1, numGuests2, numGuests3
  ].forEach(el => {
    if (el) {
      el.addEventListener("input", updateSummary);
      el.addEventListener("change", updateSummary);
    }
  });

  // ⭐ Listen for changes in star rating checkboxes
  starRatings.forEach(cb => cb.addEventListener("change", updateSummary));

  // Initial load
  updateSummary();
});
